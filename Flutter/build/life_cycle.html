<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>生命周期 | 笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.74434097.css" as="style"><link rel="preload" href="/assets/js/app.216bec1f.js" as="script"><link rel="preload" href="/assets/js/2.1e993694.js" as="script"><link rel="preload" href="/assets/js/1.e2ea3b26.js" as="script"><link rel="preload" href="/assets/js/22.60da025a.js" as="script"><link rel="prefetch" href="/assets/js/10.d5cd1a3b.js"><link rel="prefetch" href="/assets/js/100.26f59802.js"><link rel="prefetch" href="/assets/js/101.a324009d.js"><link rel="prefetch" href="/assets/js/102.4d35dc40.js"><link rel="prefetch" href="/assets/js/103.43eabbce.js"><link rel="prefetch" href="/assets/js/104.98705b9d.js"><link rel="prefetch" href="/assets/js/11.c389195a.js"><link rel="prefetch" href="/assets/js/12.d8e96b1c.js"><link rel="prefetch" href="/assets/js/13.da1e32c4.js"><link rel="prefetch" href="/assets/js/14.325d9a90.js"><link rel="prefetch" href="/assets/js/15.5542c093.js"><link rel="prefetch" href="/assets/js/16.667c4e84.js"><link rel="prefetch" href="/assets/js/17.bd8d538c.js"><link rel="prefetch" href="/assets/js/18.6d3b94c1.js"><link rel="prefetch" href="/assets/js/19.71fc6202.js"><link rel="prefetch" href="/assets/js/20.dd2299aa.js"><link rel="prefetch" href="/assets/js/21.54d7136c.js"><link rel="prefetch" href="/assets/js/23.e6adf6f4.js"><link rel="prefetch" href="/assets/js/24.9663ba71.js"><link rel="prefetch" href="/assets/js/25.0145f894.js"><link rel="prefetch" href="/assets/js/26.b9951f31.js"><link rel="prefetch" href="/assets/js/27.c36dbdac.js"><link rel="prefetch" href="/assets/js/28.44f29683.js"><link rel="prefetch" href="/assets/js/29.e9da48d6.js"><link rel="prefetch" href="/assets/js/3.a824ab41.js"><link rel="prefetch" href="/assets/js/30.16740628.js"><link rel="prefetch" href="/assets/js/31.5570b147.js"><link rel="prefetch" href="/assets/js/32.1ee83478.js"><link rel="prefetch" href="/assets/js/33.5bc4da0f.js"><link rel="prefetch" href="/assets/js/34.82440dbc.js"><link rel="prefetch" href="/assets/js/35.253f9085.js"><link rel="prefetch" href="/assets/js/36.a85499bb.js"><link rel="prefetch" href="/assets/js/37.d371149d.js"><link rel="prefetch" href="/assets/js/38.1db5712e.js"><link rel="prefetch" href="/assets/js/39.495cf2fe.js"><link rel="prefetch" href="/assets/js/4.21631b9f.js"><link rel="prefetch" href="/assets/js/40.79dc2b0b.js"><link rel="prefetch" href="/assets/js/41.504150b8.js"><link rel="prefetch" href="/assets/js/42.677ec064.js"><link rel="prefetch" href="/assets/js/43.3140ffa9.js"><link rel="prefetch" href="/assets/js/44.c448199b.js"><link rel="prefetch" href="/assets/js/45.ffd2b8e7.js"><link rel="prefetch" href="/assets/js/46.dd1e64a9.js"><link rel="prefetch" href="/assets/js/47.50089f82.js"><link rel="prefetch" href="/assets/js/48.ac30e75d.js"><link rel="prefetch" href="/assets/js/49.b4e1c706.js"><link rel="prefetch" href="/assets/js/5.3541f52b.js"><link rel="prefetch" href="/assets/js/50.d7b1706c.js"><link rel="prefetch" href="/assets/js/51.0f268b88.js"><link rel="prefetch" href="/assets/js/52.5dc6da17.js"><link rel="prefetch" href="/assets/js/53.2591d25b.js"><link rel="prefetch" href="/assets/js/54.def92cbd.js"><link rel="prefetch" href="/assets/js/55.543ff3f3.js"><link rel="prefetch" href="/assets/js/56.cde5825f.js"><link rel="prefetch" href="/assets/js/57.7d27166c.js"><link rel="prefetch" href="/assets/js/58.5013afec.js"><link rel="prefetch" href="/assets/js/59.3e72e950.js"><link rel="prefetch" href="/assets/js/6.6ed82868.js"><link rel="prefetch" href="/assets/js/60.122a993d.js"><link rel="prefetch" href="/assets/js/61.7b0f629a.js"><link rel="prefetch" href="/assets/js/62.3f894bae.js"><link rel="prefetch" href="/assets/js/63.e8d09bf4.js"><link rel="prefetch" href="/assets/js/64.bcd70498.js"><link rel="prefetch" href="/assets/js/65.501cca3a.js"><link rel="prefetch" href="/assets/js/66.0ca59ac6.js"><link rel="prefetch" href="/assets/js/67.1a7b9c7d.js"><link rel="prefetch" href="/assets/js/68.a666b424.js"><link rel="prefetch" href="/assets/js/69.2fc5c8db.js"><link rel="prefetch" href="/assets/js/7.4dbea005.js"><link rel="prefetch" href="/assets/js/70.9475d2b2.js"><link rel="prefetch" href="/assets/js/71.c6b46e84.js"><link rel="prefetch" href="/assets/js/72.02b74fca.js"><link rel="prefetch" href="/assets/js/73.4fae572d.js"><link rel="prefetch" href="/assets/js/74.8f00411d.js"><link rel="prefetch" href="/assets/js/75.e50d3a86.js"><link rel="prefetch" href="/assets/js/76.dc989c1c.js"><link rel="prefetch" href="/assets/js/77.4322bd0a.js"><link rel="prefetch" href="/assets/js/78.841ddaed.js"><link rel="prefetch" href="/assets/js/79.c6be5bb4.js"><link rel="prefetch" href="/assets/js/80.5a54b4fb.js"><link rel="prefetch" href="/assets/js/81.6534611d.js"><link rel="prefetch" href="/assets/js/82.b827c774.js"><link rel="prefetch" href="/assets/js/83.013b6aef.js"><link rel="prefetch" href="/assets/js/84.def83e64.js"><link rel="prefetch" href="/assets/js/85.9f1630cc.js"><link rel="prefetch" href="/assets/js/86.a794c1df.js"><link rel="prefetch" href="/assets/js/87.61619766.js"><link rel="prefetch" href="/assets/js/88.ab39111a.js"><link rel="prefetch" href="/assets/js/89.268869da.js"><link rel="prefetch" href="/assets/js/90.c2956654.js"><link rel="prefetch" href="/assets/js/91.92fc0ad5.js"><link rel="prefetch" href="/assets/js/92.a3214003.js"><link rel="prefetch" href="/assets/js/93.296e0484.js"><link rel="prefetch" href="/assets/js/94.c7c51717.js"><link rel="prefetch" href="/assets/js/95.99b7f150.js"><link rel="prefetch" href="/assets/js/96.80f58e89.js"><link rel="prefetch" href="/assets/js/97.354b2dfb.js"><link rel="prefetch" href="/assets/js/98.ae4fdaa7.js"><link rel="prefetch" href="/assets/js/99.bb4463f1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5cff1987.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74434097.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>机器学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dart</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Flutter/" class="sidebar-heading clickable router-link-active open"><span>Flutter</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Flutter/provider.html" class="sidebar-link">Provider</a></li><li><a href="/Flutter/sliver.html" class="sidebar-link">Sliver</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Flutter/build" class="sidebar-heading clickable router-link-active open"><span>build</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Flutter/build/library_builder.html" class="sidebar-link">LibraryBuilder分析</a></li><li><a href="/Flutter/build/life_cycle.html" aria-current="page" class="active sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Flutter/build/life_cycle.html#element生命周期" class="sidebar-link">Element生命周期</a></li><li class="sidebar-sub-header"><a href="/Flutter/build/life_cycle.html#state生命周期" class="sidebar-link">State生命周期</a></li><li class="sidebar-sub-header"><a href="/Flutter/build/life_cycle.html#renderobject生命周期" class="sidebar-link">RenderObject生命周期</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>layout</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>核心Widget</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Flutter/navigator" class="sidebar-heading clickable"><span>navigator</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Flutter/GetX" class="sidebar-heading clickable"><span>GetX</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Java/" class="sidebar-heading clickable"><span>Java</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Android/" class="sidebar-heading clickable"><span>Android</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Git/" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h1> <p>Element不仅维护Element树，同时还负责维护Render树。所以无论是State生命周期，还是Element生命周期，或者RenderObject生命周期，都是由Element来维护。Element有很多类型，如ComponentElement，RenderObjectElement等，他们在Element生命周期的基础上有不同的扩展，以此来hook State生命周期，RenderObject生命周期。</p> <h2 id="element生命周期"><a href="#element生命周期" class="header-anchor">#</a> Element生命周期</h2> <p>最基础的Element生命周期很简单，只有四种状态：<code>initial</code>,<code>active</code>,<code>inactive</code>,<code>defunct</code>.</p> <ol><li><strong>initial</strong> : Element的默认状态。</li> <li><strong>active</strong> : 当Element被插入Element树后的状态，当插入完成，当前Element对应的RenderObject也会被插入树中。</li> <li><strong>inactive</strong> : 当Element被移除Element树后的状态，移除完成时，当前Element对应的RenderObject也会被从Render树移除。</li> <li><strong>defunct</strong> : Element彻底不可用。当inactive的Element没有在当前frame从新被插入树中触发。</li></ol> <p><code>initial</code>和<code>defunct</code>状态存在的时间都非常短，我们没有机会观察到处于<code>initial</code>状态的Element，因为Framework在创建Element后会立即插入。而<code>defunct</code>状态的Element也不存在任何可达引用，会被垃圾收集器回收。</p> <p><code>inactive</code>状态只存在于drawframe期间，在drawFrame后，要么从新插入树=&gt;<code>active</code>，要么彻底移除=&gt;<code>defunct</code>.</p> <p><code>active</code>状态是停留在树中时的状态，所有可见元素都是这个状态。</p> <p><img src="/assets/img/Element_Lifecycle.f018ac63.png" alt="Element Lifecycle"></p> <h2 id="state生命周期"><a href="#state生命周期" class="header-anchor">#</a> State生命周期</h2> <p>State的生命周期依赖于Element生命周期，由StatefulElement传递生命周期hook到State。</p> <p>Element.mount() =&gt; _firstBuild() =&gt; {initState();didChangeDependencies();}
Element.unmount() =&gt; state.dispose();
Element.deactivate() =&gt; state.deactivate();
Element.update()=&gt;DidUpdateWidget;</p> <ol><li>Create: 实例化State，一般我们不关心这个生命周期回调。创建完State后，Element才完成实例化。</li> <li>InitState: 在Element被挂载到树时触发，一般用于初始化数据，在整个Element生命周期，只会触发一次。</li> <li>Dependencies：第一次在Element挂载时触发， 后续随着依赖的InheritedWidget发生改变时触发，所以在这里查询InheritedWidget数据是合适的。一般我们也可以在build中查询，毕竟didChangeDependencies后一定会build。但是如果是耗时工作，最好不要放在build。</li> <li>build：构建Widget树，没啥说的。</li> <li>DidUpdateWidget：使用新的Widget更新Element时触发。后面一定会触发build。</li> <li>Deactivate：当Element从树中移除是触发。</li> <li>Activate：当Element重新插入树中时触发。</li> <li>Dispose： 当Element被永久移除是触发。</li></ol> <p><img src="/assets/img/State_Lifecycle.d8a5e9c2.png" alt="State Lifecycle"></p> <h2 id="renderobject生命周期"><a href="#renderobject生命周期" class="header-anchor">#</a> RenderObject生命周期</h2> <p>Element.mount() =&gt; createRenderObject</p> <p>Element.mount() =&gt; attachRenderObject</p> <ol><li>create</li> <li>layout</li> <li>paint</li> <li>repaint</li> <li>destory</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Flutter/build/library_builder.html" class="prev">
        LibraryBuilder分析
      </a></span> <span class="next"><a href="/Flutter/layout/layout.html">
        布局流程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.216bec1f.js" defer></script><script src="/assets/js/2.1e993694.js" defer></script><script src="/assets/js/1.e2ea3b26.js" defer></script><script src="/assets/js/22.60da025a.js" defer></script>
  </body>
</html>
